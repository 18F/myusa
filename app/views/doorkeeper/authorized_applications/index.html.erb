<header class="page-header">
  <h1>Settings</h1>
  <p class="sub-heading">Authorized Applications</p>
</header>

<div class="main">
  <div class="row">
    <div class="col-md-12">
      <% @applications.each do |application| %>
        <div class="panel panel-default">
          <div class="panel-heading">
            <div class="row">
              <div class="col-md-7">
                <h3 class="panel-title">
                  <%= application.name %>
                </h3>
              </div>
              <div class="col-md-3 text-right">
                <h3 class="panel-title">
                  Granted: <%= application.created_at.strftime('%m/%d/%Y') %>
                </h3>
              </div>
              <div class="col-md-2 text-right">
                <h3 class="panel-title">
                  <%= render 'delete_form', application: application %>
                </h3>
              </div>
            </div>
          </div>
          <div class="panel-body">
            <h4>Permissions</h4>
              <ul class="list-unstyled scope-list">
                <% pre_auth_groups(application.scopes).each do |set| %>
                  <li>
                    <h2 class='open group'>
                      <%= t("scope_groups.#{set[:name]}.header") %>
                    </h2>
                    <div class="label-pad">
                      <span class="muted-minor">
                        <%= t("scope_groups.#{set[:name]}.sub") %>
                      </span>
                      </br>
                      <% set[:groups].each do |group| %>
                        <div class='row top-buffer'>
                          <div class = 'col-md-3'>
                            <label>
                            <%=t("group_labels.#{group[:label]}")%>
                            </label>
                          </div>
                          <div class = 'col-md-9'>
                          <% group[:group].each do |scope| %>
                            <span class='label-pad'>
                              <% if scope.downcase.starts_with?("profile.")  %>
                                <%= check_box_tag 'scope[]', scope, true, multiple: true%>
                                <% if SELECT_MENU_SCOPES.include? scope %>
                                  <%= profile_select_menu scope, class:'form-control'%>
                                <% else %>
                                  <%= profile_text_field scope, class:'form-control'%>
                                <% end %>
                              <% else %>
                                <%= current_user.scope_field_value(scope)%></label>
                              <% end %>
                            </span>
                          <% end %>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  </li>
                <% end %>
              </ul>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
